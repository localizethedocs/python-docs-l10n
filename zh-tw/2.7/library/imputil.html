
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="zh_TW">
  <head>
    <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>31.3. imputil — Import utilities &#8212; Python 2.7.18 說明文件</title><meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <link rel="stylesheet" href="../_static/pydoctheme.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/language_data.js"></script>
    <script type="text/javascript" src="../_static/translations.js"></script>
    
    <script type="text/javascript" src="../_static/sidebar.js"></script>
    
    <link rel="canonical" href="https://projects.localizethedocs.org/python-docs-l10n/library/imputil.html" />
    <link rel="search" type="application/opensearchdescription+xml"
          title="在 Python 2.7.18 說明文件 中搜尋"
          href="../_static/opensearch.xml"/>
    <link rel="author" title="關於這些文件" href="../about.html" />
    <link rel="index" title="索引" href="../genindex.html" />
    <link rel="search" title="搜尋" href="../search.html" />
    <link rel="copyright" title="版權所有" href="../copyright.html" />
    <link rel="next" title="31.4. zipimport — Import modules from Zip archives" href="zipimport.html" />
    <link rel="prev" title="31.2. importlib — Convenience wrappers for __import__()" href="importlib.html" />
    
    <link rel="canonical" href="https://docs.python.org/3/library/imputil.html" />
    
      
    

    
    <style>
      @media only screen {
        table.full-width-table {
            width: 100%;
        }
      }
    </style>
<link rel="shortcut icon" type="image/png" href="../_static/py.svg" />
            <script type="text/javascript" src="../_static/copybutton.js"></script>
            <script type="text/javascript" src="../_static/menu.js"></script> 
            <script type="text/javascript" src="../_static/rtd_switcher.js"></script>
            <meta name="readthedocs-addons-api-version" content="1">
            <script type="text/javascript" src="../ltd-provenance.js"></script>
            <script type="text/javascript" src="../ltd-current.js"></script>
            <script type="text/javascript" src="../../../ltd-config.js"></script>
            <script type="text/javascript" src="../../../ltd-flyout.js"></script>

  </head>
<body>
<div class="mobile-nav">
    <input type="checkbox" id="menuToggler" class="toggler__input" aria-controls="navigation"
           aria-pressed="false" aria-expanded="false" role="button" aria-label="Menu" />
    <label for="menuToggler" class="toggler__label">
        <span></span>
    </label>
    <nav class="nav-content" role="navigation">
         <a href="https://www.python.org/" class="nav-logo">
             <img src="../_static/py.svg" alt="Logo"/>
         </a>
        <div class="version_switcher_placeholder"></div>
        <form id="searchbox" role="search" class="search" action="../search.html" method="get">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" class="search-icon">
                <path fill-rule="nonzero"
                        d="M15.5 14h-.79l-.28-.27a6.5 6.5 0 001.48-5.34c-.47-2.78-2.79-5-5.59-5.34a6.505 6.505 0 00-7.27 7.27c.34 2.8 2.56 5.12 5.34 5.59a6.5 6.5 0 005.34-1.48l.27.28v.79l4.25 4.25c.41.41 1.08.41 1.49 0 .41-.41.41-1.08 0-1.49L15.5 14zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z" fill="#444"></path>
            </svg>
            <input type="text" name="q" aria-label="快速搜尋"/>
            <input type="submit" value="搜"/>
        </form>
    </nav>
    <div class="menu-wrapper">
        <nav class="menu" role="navigation" aria-label="main navigation">
            <div class="language_switcher_placeholder"></div>
  <h3><a href="../contents.html">目录</a></h3>
  <ul>
<li><a class="reference internal" href="#">31.3. <code class="xref py py-mod docutils literal notranslate"><span class="pre">imputil</span></code> — Import utilities</a><ul>
<li><a class="reference internal" href="#examples">31.3.1. Examples</a></li>
</ul>
</li>
</ul>

  <h4>上個主題</h4>
  <p class="topless"><a href="importlib.html"
                        title="上一章"><span class="section-number">31.2. </span><code class="xref py py-mod docutils literal notranslate"><span class="pre">importlib</span></code> — Convenience wrappers for <code class="xref py py-func docutils literal notranslate"><span class="pre">__import__()</span></code></a></p>
  <h4>下個主題</h4>
  <p class="topless"><a href="zipimport.html"
                        title="下一章"><span class="section-number">31.4. </span><code class="xref py py-mod docutils literal notranslate"><span class="pre">zipimport</span></code> — Import modules from Zip archives</a></p>
  <div role="note" aria-label="source link">
    <h3>本頁</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/library/imputil.rst.txt"
            rel="nofollow">顯示原始碼</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">快速搜尋</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="搜" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </nav>
    </div>
</div>

<div id="outdated-warning" style="padding: .5em; text-align: center; background-color: #FFBABA; color: #6A0E0E;">
    This document is for an old version of Python that is no longer supported.
    You should upgrade, and read the
    <a href="/3/library/imputil.html">Python documentation for the current stable release</a>.
</div>
  
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>瀏覽</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="總索引"
             accesskey="I">索引</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python 模組索引"
             >模組</a> |</li>
        <li class="right" >
          <a href="zipimport.html" title="31.4. zipimport — Import modules from Zip archives"
             accesskey="N">下一頁</a> |</li>
        <li class="right" >
          <a href="importlib.html" title="31.2. importlib — Convenience wrappers for __import__()"
             accesskey="P">上一頁</a> |</li>

          <li><img src="../_static/py.svg" alt="python logo" style="vertical-align: middle; margin-top: -1px"/></li>
          <li><a href="https://www.python.org/">Python</a> &#187;</li>
          <li class="switchers">
            <div class="language_switcher_placeholder"></div>
            <div class="version_switcher_placeholder"></div>
          </li>
          <li>
              
          </li>
          <li id="cpython-language-and-version">
            <a href="../index.html">Python 2.7.18 說明文件</a> &#187;
          </li>

          <li class="nav-item nav-item-1"><a href="index.html" >The Python Standard Library</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="modules.html" accesskey="U"><span class="section-number">31. </span>Importing Modules</a> &#187;</li>
                <li class="right">
                    

    <div class="inline-search" role="search">
        <form class="inline-search" action="../search.html" method="get">
          <input placeholder="快速搜尋" aria-label="快速搜尋" type="text" name="q" />
          <input type="submit" value="搜" />
          <input type="hidden" name="check_keywords" value="yes" />
          <input type="hidden" name="area" value="default" />
        </form>
    </div>
                     |
                </li>
            
      </ul>
    </div>    

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="module-imputil">
<span id="imputil-import-utilities"></span><h1><span class="section-number">31.3. </span><a class="reference internal" href="#module-imputil" title="imputil: Manage and augment the import process.(已棄用)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">imputil</span></code></a> — Import utilities<a class="headerlink" href="#module-imputil" title="本標題的永久連結">¶</a></h1>
<div class="deprecated">
<p><span class="versionmodified deprecated">2.6 版後已棄用: </span>The <a class="reference internal" href="#module-imputil" title="imputil: Manage and augment the import process.(已棄用)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">imputil</span></code></a> module has been removed in Python 3.</p>
</div>
<p id="index-0">This module provides a very handy and useful mechanism for custom
<a class="reference internal" href="../reference/simple_stmts.html#import"><code class="xref std std-keyword docutils literal notranslate"><span class="pre">import</span></code></a> hooks. Compared to the older <code class="xref py py-mod docutils literal notranslate"><span class="pre">ihooks</span></code> module,
<a class="reference internal" href="#module-imputil" title="imputil: Manage and augment the import process.(已棄用)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">imputil</span></code></a> takes a dramatically simpler and more straight-forward
approach to custom <a class="reference internal" href="../reference/simple_stmts.html#import"><code class="xref std std-keyword docutils literal notranslate"><span class="pre">import</span></code></a> functions.</p>
<dl class="class">
<dt id="imputil.ImportManager">
<em class="property">class </em><code class="sig-prename descclassname">imputil.</code><code class="sig-name descname">ImportManager</code><span class="sig-paren">(</span><span class="optional">[</span><em class="sig-param">fs_imp</em><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#imputil.ImportManager" title="本定義的永久連結">¶</a></dt>
<dd><p>Manage the import process.</p>
<dl class="method">
<dt id="imputil.ImportManager.install">
<code class="sig-name descname">install</code><span class="sig-paren">(</span><span class="optional">[</span><em class="sig-param">namespace</em><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#imputil.ImportManager.install" title="本定義的永久連結">¶</a></dt>
<dd><p>Install this ImportManager into the specified namespace.</p>
</dd></dl>

<dl class="method">
<dt id="imputil.ImportManager.uninstall">
<code class="sig-name descname">uninstall</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#imputil.ImportManager.uninstall" title="本定義的永久連結">¶</a></dt>
<dd><p>Restore the previous import mechanism.</p>
</dd></dl>

<dl class="method">
<dt id="imputil.ImportManager.add_suffix">
<code class="sig-name descname">add_suffix</code><span class="sig-paren">(</span><em class="sig-param">suffix</em>, <em class="sig-param">importFunc</em><span class="sig-paren">)</span><a class="headerlink" href="#imputil.ImportManager.add_suffix" title="本定義的永久連結">¶</a></dt>
<dd><p>Undocumented.</p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="imputil.Importer">
<em class="property">class </em><code class="sig-prename descclassname">imputil.</code><code class="sig-name descname">Importer</code><a class="headerlink" href="#imputil.Importer" title="本定義的永久連結">¶</a></dt>
<dd><p>Base class for replacing standard import functions.</p>
<dl class="method">
<dt id="imputil.Importer.import_top">
<code class="sig-name descname">import_top</code><span class="sig-paren">(</span><em class="sig-param">name</em><span class="sig-paren">)</span><a class="headerlink" href="#imputil.Importer.import_top" title="本定義的永久連結">¶</a></dt>
<dd><p>Import a top-level module.</p>
</dd></dl>

<dl class="method">
<dt id="imputil.Importer.get_code">
<code class="sig-name descname">get_code</code><span class="sig-paren">(</span><em class="sig-param">parent</em>, <em class="sig-param">modname</em>, <em class="sig-param">fqname</em><span class="sig-paren">)</span><a class="headerlink" href="#imputil.Importer.get_code" title="本定義的永久連結">¶</a></dt>
<dd><p>Find and retrieve the code for the given module.</p>
<p><em>parent</em> specifies a parent module to define a context for importing.
It may be <code class="docutils literal notranslate"><span class="pre">None</span></code>, indicating no particular context for the search.</p>
<p><em>modname</em> specifies a single module (not dotted) within the parent.</p>
<p><em>fqname</em> specifies the fully-qualified module name. This is a
(potentially) dotted name from the 「root」 of the module namespace
down to the modname.</p>
<p>If there is no parent, then modname==fqname.</p>
<p>This method should return <code class="docutils literal notranslate"><span class="pre">None</span></code>, or a 3-tuple.</p>
<blockquote>
<div><ul class="simple">
<li><p>If the module was not found, then <code class="docutils literal notranslate"><span class="pre">None</span></code> should be returned.</p></li>
<li><p>The first item of the 2- or 3-tuple should be the integer 0 or 1,
specifying whether the module that was found is a package or not.</p></li>
<li><p>The second item is the code object for the module (it will be
executed within the new module’s namespace). This item can also
be a fully-loaded module object (e.g. loaded from a shared lib).</p></li>
<li><p>The third item is a dictionary of name/value pairs that will be
inserted into new module before the code object is executed. This
is provided in case the module’s code expects certain values (such
as where the module was found). When the second item is a module
object, then these names/values will be inserted <em>after</em> the module
has been loaded/initialized.</p></li>
</ul>
</div></blockquote>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="imputil.BuiltinImporter">
<em class="property">class </em><code class="sig-prename descclassname">imputil.</code><code class="sig-name descname">BuiltinImporter</code><a class="headerlink" href="#imputil.BuiltinImporter" title="本定義的永久連結">¶</a></dt>
<dd><p>Emulate the import mechanism for built-in and frozen modules.  This is a
sub-class of the <a class="reference internal" href="#imputil.Importer" title="imputil.Importer"><code class="xref py py-class docutils literal notranslate"><span class="pre">Importer</span></code></a> class.</p>
<dl class="method">
<dt id="imputil.BuiltinImporter.get_code">
<code class="sig-name descname">get_code</code><span class="sig-paren">(</span><em class="sig-param">parent</em>, <em class="sig-param">modname</em>, <em class="sig-param">fqname</em><span class="sig-paren">)</span><a class="headerlink" href="#imputil.BuiltinImporter.get_code" title="本定義的永久連結">¶</a></dt>
<dd><p>Undocumented.</p>
</dd></dl>

</dd></dl>

<dl class="function">
<dt id="imputil.py_suffix_importer">
<code class="sig-prename descclassname">imputil.</code><code class="sig-name descname">py_suffix_importer</code><span class="sig-paren">(</span><em class="sig-param">filename</em>, <em class="sig-param">finfo</em>, <em class="sig-param">fqname</em><span class="sig-paren">)</span><a class="headerlink" href="#imputil.py_suffix_importer" title="本定義的永久連結">¶</a></dt>
<dd><p>Undocumented.</p>
</dd></dl>

<dl class="class">
<dt id="imputil.DynLoadSuffixImporter">
<em class="property">class </em><code class="sig-prename descclassname">imputil.</code><code class="sig-name descname">DynLoadSuffixImporter</code><span class="sig-paren">(</span><span class="optional">[</span><em class="sig-param">desc</em><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#imputil.DynLoadSuffixImporter" title="本定義的永久連結">¶</a></dt>
<dd><p>Undocumented.</p>
<dl class="method">
<dt id="imputil.DynLoadSuffixImporter.import_file">
<code class="sig-name descname">import_file</code><span class="sig-paren">(</span><em class="sig-param">filename</em>, <em class="sig-param">finfo</em>, <em class="sig-param">fqname</em><span class="sig-paren">)</span><a class="headerlink" href="#imputil.DynLoadSuffixImporter.import_file" title="本定義的永久連結">¶</a></dt>
<dd><p>Undocumented.</p>
</dd></dl>

</dd></dl>

<section id="examples">
<span id="examples-imputil"></span><h2><span class="section-number">31.3.1. </span>Examples<a class="headerlink" href="#examples" title="本標題的永久連結">¶</a></h2>
<p>This is a re-implementation of hierarchical module import.</p>
<p>This code is intended to be read, not executed.  However, it does work
– all you need to do to enable it is 「import knee」.</p>
<p>(The name is a pun on the clunkier predecessor of this module, 「ni」.)</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">sys</span><span class="o">,</span> <span class="nn">imp</span><span class="o">,</span> <span class="nn">__builtin__</span>

<span class="c1"># Replacement for __import__()</span>
<span class="k">def</span> <span class="nf">import_hook</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="nb">globals</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="nb">locals</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fromlist</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="n">parent</span> <span class="o">=</span> <span class="n">determine_parent</span><span class="p">(</span><span class="nb">globals</span><span class="p">)</span>
    <span class="n">q</span><span class="p">,</span> <span class="n">tail</span> <span class="o">=</span> <span class="n">find_head_package</span><span class="p">(</span><span class="n">parent</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">load_tail</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">tail</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">fromlist</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">q</span>
    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="s2">&quot;__path__&quot;</span><span class="p">):</span>
        <span class="n">ensure_fromlist</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">fromlist</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">m</span>

<span class="k">def</span> <span class="nf">determine_parent</span><span class="p">(</span><span class="nb">globals</span><span class="p">):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">globals</span> <span class="ow">or</span>  <span class="ow">not</span> <span class="nb">globals</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="s2">&quot;__name__&quot;</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="n">pname</span> <span class="o">=</span> <span class="nb">globals</span><span class="p">[</span><span class="s1">&#39;__name__&#39;</span><span class="p">]</span>
    <span class="k">if</span> <span class="nb">globals</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="s2">&quot;__path__&quot;</span><span class="p">):</span>
        <span class="n">parent</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="n">pname</span><span class="p">]</span>
        <span class="k">assert</span> <span class="nb">globals</span> <span class="ow">is</span> <span class="n">parent</span><span class="o">.</span><span class="vm">__dict__</span>
        <span class="k">return</span> <span class="n">parent</span>
    <span class="k">if</span> <span class="s1">&#39;.&#39;</span> <span class="ow">in</span> <span class="n">pname</span><span class="p">:</span>
        <span class="n">i</span> <span class="o">=</span> <span class="n">pname</span><span class="o">.</span><span class="n">rfind</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>
        <span class="n">pname</span> <span class="o">=</span> <span class="n">pname</span><span class="p">[:</span><span class="n">i</span><span class="p">]</span>
        <span class="n">parent</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="n">pname</span><span class="p">]</span>
        <span class="k">assert</span> <span class="n">parent</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">==</span> <span class="n">pname</span>
        <span class="k">return</span> <span class="n">parent</span>
    <span class="k">return</span> <span class="kc">None</span>

<span class="k">def</span> <span class="nf">find_head_package</span><span class="p">(</span><span class="n">parent</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
    <span class="k">if</span> <span class="s1">&#39;.&#39;</span> <span class="ow">in</span> <span class="n">name</span><span class="p">:</span>
        <span class="n">i</span> <span class="o">=</span> <span class="n">name</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>
        <span class="n">head</span> <span class="o">=</span> <span class="n">name</span><span class="p">[:</span><span class="n">i</span><span class="p">]</span>
        <span class="n">tail</span> <span class="o">=</span> <span class="n">name</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">:]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">head</span> <span class="o">=</span> <span class="n">name</span>
        <span class="n">tail</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="k">if</span> <span class="n">parent</span><span class="p">:</span>
        <span class="n">qname</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">.</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">parent</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">head</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">qname</span> <span class="o">=</span> <span class="n">head</span>
    <span class="n">q</span> <span class="o">=</span> <span class="n">import_module</span><span class="p">(</span><span class="n">head</span><span class="p">,</span> <span class="n">qname</span><span class="p">,</span> <span class="n">parent</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">q</span><span class="p">:</span> <span class="k">return</span> <span class="n">q</span><span class="p">,</span> <span class="n">tail</span>
    <span class="k">if</span> <span class="n">parent</span><span class="p">:</span>
        <span class="n">qname</span> <span class="o">=</span> <span class="n">head</span>
        <span class="n">parent</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">q</span> <span class="o">=</span> <span class="n">import_module</span><span class="p">(</span><span class="n">head</span><span class="p">,</span> <span class="n">qname</span><span class="p">,</span> <span class="n">parent</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">q</span><span class="p">:</span> <span class="k">return</span> <span class="n">q</span><span class="p">,</span> <span class="n">tail</span>
    <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span><span class="s2">&quot;No module named &quot;</span> <span class="o">+</span> <span class="n">qname</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">load_tail</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">tail</span><span class="p">):</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">q</span>
    <span class="k">while</span> <span class="n">tail</span><span class="p">:</span>
        <span class="n">i</span> <span class="o">=</span> <span class="n">tail</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span> <span class="n">i</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">tail</span><span class="p">)</span>
        <span class="n">head</span><span class="p">,</span> <span class="n">tail</span> <span class="o">=</span> <span class="n">tail</span><span class="p">[:</span><span class="n">i</span><span class="p">],</span> <span class="n">tail</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">:]</span>
        <span class="n">mname</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">.</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">head</span><span class="p">)</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">import_module</span><span class="p">(</span><span class="n">head</span><span class="p">,</span> <span class="n">mname</span><span class="p">,</span> <span class="n">m</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">m</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span><span class="s2">&quot;No module named &quot;</span> <span class="o">+</span> <span class="n">mname</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">m</span>

<span class="k">def</span> <span class="nf">ensure_fromlist</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">fromlist</span><span class="p">,</span> <span class="n">recursive</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">sub</span> <span class="ow">in</span> <span class="n">fromlist</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">sub</span> <span class="o">==</span> <span class="s2">&quot;*&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">recursive</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="nb">all</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">__all__</span>
                <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                    <span class="k">pass</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">ensure_fromlist</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="nb">all</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="k">continue</span>
        <span class="k">if</span> <span class="n">sub</span> <span class="o">!=</span> <span class="s2">&quot;*&quot;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">sub</span><span class="p">):</span>
            <span class="n">subname</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">.</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">sub</span><span class="p">)</span>
            <span class="n">submod</span> <span class="o">=</span> <span class="n">import_module</span><span class="p">(</span><span class="n">sub</span><span class="p">,</span> <span class="n">subname</span><span class="p">,</span> <span class="n">m</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">submod</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span><span class="s2">&quot;No module named &quot;</span> <span class="o">+</span> <span class="n">subname</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">import_module</span><span class="p">(</span><span class="n">partname</span><span class="p">,</span> <span class="n">fqname</span><span class="p">,</span> <span class="n">parent</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="n">fqname</span><span class="p">]</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="k">pass</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">fp</span><span class="p">,</span> <span class="n">pathname</span><span class="p">,</span> <span class="n">stuff</span> <span class="o">=</span> <span class="n">imp</span><span class="o">.</span><span class="n">find_module</span><span class="p">(</span><span class="n">partname</span><span class="p">,</span>
                                              <span class="n">parent</span> <span class="ow">and</span> <span class="n">parent</span><span class="o">.</span><span class="n">__path__</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">imp</span><span class="o">.</span><span class="n">load_module</span><span class="p">(</span><span class="n">fqname</span><span class="p">,</span> <span class="n">fp</span><span class="p">,</span> <span class="n">pathname</span><span class="p">,</span> <span class="n">stuff</span><span class="p">)</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">fp</span><span class="p">:</span> <span class="n">fp</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">parent</span><span class="p">:</span>
        <span class="nb">setattr</span><span class="p">(</span><span class="n">parent</span><span class="p">,</span> <span class="n">partname</span><span class="p">,</span> <span class="n">m</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">m</span>


<span class="c1"># Replacement for reload()</span>
<span class="k">def</span> <span class="nf">reload_hook</span><span class="p">(</span><span class="n">module</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">module</span><span class="o">.</span><span class="vm">__name__</span>
    <span class="k">if</span> <span class="s1">&#39;.&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">name</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">import_module</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">i</span> <span class="o">=</span> <span class="n">name</span><span class="o">.</span><span class="n">rfind</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>
    <span class="n">pname</span> <span class="o">=</span> <span class="n">name</span><span class="p">[:</span><span class="n">i</span><span class="p">]</span>
    <span class="n">parent</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="n">pname</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">import_module</span><span class="p">(</span><span class="n">name</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">:],</span> <span class="n">name</span><span class="p">,</span> <span class="n">parent</span><span class="p">)</span>


<span class="c1"># Save the original hooks</span>
<span class="n">original_import</span> <span class="o">=</span> <span class="n">__builtin__</span><span class="o">.</span><span class="n">__import__</span>
<span class="n">original_reload</span> <span class="o">=</span> <span class="n">__builtin__</span><span class="o">.</span><span class="n">reload</span>

<span class="c1"># Now install our hooks</span>
<span class="n">__builtin__</span><span class="o">.</span><span class="n">__import__</span> <span class="o">=</span> <span class="n">import_hook</span>
<span class="n">__builtin__</span><span class="o">.</span><span class="n">reload</span> <span class="o">=</span> <span class="n">reload_hook</span>
</pre></div>
</div>
<p id="index-1">Also see the <code class="xref py py-mod docutils literal notranslate"><span class="pre">importers</span></code> module (which can be found
in <code class="file docutils literal notranslate"><span class="pre">Demo/imputil/</span></code> in the Python source distribution) for additional
examples.</p>
</section>
</section>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../contents.html">目录</a></h3>
  <ul>
<li><a class="reference internal" href="#">31.3. <code class="xref py py-mod docutils literal notranslate"><span class="pre">imputil</span></code> — Import utilities</a><ul>
<li><a class="reference internal" href="#examples">31.3.1. Examples</a></li>
</ul>
</li>
</ul>

  <h4>上個主題</h4>
  <p class="topless"><a href="importlib.html"
                        title="上一章"><span class="section-number">31.2. </span><code class="xref py py-mod docutils literal notranslate"><span class="pre">importlib</span></code> — Convenience wrappers for <code class="xref py py-func docutils literal notranslate"><span class="pre">__import__()</span></code></a></p>
  <h4>下個主題</h4>
  <p class="topless"><a href="zipimport.html"
                        title="下一章"><span class="section-number">31.4. </span><code class="xref py py-mod docutils literal notranslate"><span class="pre">zipimport</span></code> — Import modules from Zip archives</a></p>
  <div role="note" aria-label="source link">
    <h3>本頁</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/library/imputil.rst.txt"
            rel="nofollow">顯示原始碼</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">快速搜尋</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="搜" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>  
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>瀏覽</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="總索引"
             >索引</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python 模組索引"
             >模組</a> |</li>
        <li class="right" >
          <a href="zipimport.html" title="31.4. zipimport — Import modules from Zip archives"
             >下一頁</a> |</li>
        <li class="right" >
          <a href="importlib.html" title="31.2. importlib — Convenience wrappers for __import__()"
             >上一頁</a> |</li>

          <li><img src="../_static/py.svg" alt="python logo" style="vertical-align: middle; margin-top: -1px"/></li>
          <li><a href="https://www.python.org/">Python</a> &#187;</li>
          <li class="switchers">
            <div class="language_switcher_placeholder"></div>
            <div class="version_switcher_placeholder"></div>
          </li>
          <li>
              
          </li>
          <li id="cpython-language-and-version">
            <a href="../index.html">Python 2.7.18 說明文件</a> &#187;
          </li>

          <li class="nav-item nav-item-1"><a href="index.html" >The Python Standard Library</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="modules.html" ><span class="section-number">31. </span>Importing Modules</a> &#187;</li>
                <li class="right">
                    

    <div class="inline-search" role="search">
        <form class="inline-search" action="../search.html" method="get">
          <input placeholder="快速搜尋" aria-label="快速搜尋" type="text" name="q" />
          <input type="submit" value="搜" />
          <input type="hidden" name="check_keywords" value="yes" />
          <input type="hidden" name="area" value="default" />
        </form>
    </div>
                     |
                </li>
            
      </ul>
    </div>  
    <div class="footer">
    &copy; <a href="../copyright.html">版權所有</a> 1990-2025, Python Software Foundation.
    <br />
    This page is licensed under the Python Software Foundation License Version 2.
    <br />
    Examples, recipes, and other code in the documentation are additionally licensed under the Zero Clause BSD License.
    <br />
    See <a href="">History and License</a> for more information.
    <br /><br />

    The Python Software Foundation is a non-profit corporation.
<a href="https://www.python.org/psf/donations/">Please donate.</a>
<br />
    <br />

    最後更新於 10月 28, 2025。
    
    <br />

    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 2.3.1.
    </div>

  </body>
</html>